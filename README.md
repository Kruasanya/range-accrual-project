# Моделирование трех скоррелированных риск-факторов (RUB, USD, FX)

Этот проект посвящён построению стохастической модели для трёх взаимосвязанных финансовых факторов:

- **RUONIA** — мгновенная процентная ставка в рублях  
- **SOFR** — мгновенная процентная ставка в долларах США  
- **RUB/USD** — валютный курс рубля к доллару  

Все расчёты, моделирование и симуляции выполняются для дальнейшего применения в **оценке и прогнозировании выплат по продукту Range Accrual**.

---

## Содержание проекта

### **1. Загрузка и очистка данных**
- Импорт исторических рядов RUONIA, SOFR и FX  
- Приведение дат и форматов  
- Объединение данных в общий временной ряд  

### **2. Анализ данных**
- Графики и статистика ставок и FX  
- Исследование волатильности  
- Корреляционный анализ всех факторов  

### **3. Стохастические модели**
- **CIR-модель** для RUONIA и SOFR  
- **GBM (логнормальная модель)** для валютного курса  
- Калибровка параметров моделей на исторических данных  

### **4. Коррелирование факторов**
- Построение ковариационной матрицы  
- Разложение Холецкого  
- Генерация коррелированных шоков для тройки факторов  

### **5. Симуляции**
- Моделирование множества траекторий RUB rate, USD rate и FX  
- Генерация реалистичных сценариев на заданном горизонте  
- Визуализация траекторий  

---

## **Основной продукт: Range Accrual**

Все шаги проекта — от загрузки данных до многомерных симуляций — направлены на создание инструмента для **оценки выплат и прогнозирования поведения Range Accrual продукта**.

Range Accrual зависит от количества дней, когда некоторый базовый показатель находится **в пределах заданного диапазона**.  
Для моделирования такого инструмента необходимы:

- сценарии процентных ставок (RUB/ USD),  
- сценарии валютного курса,  
- коррелированная многомерная динамика факторов,  
- симуляция большого числа путей.

Модель, созданная в этом проекте, позволяет:

- рассчитывать **вероятность нахождения фактора в диапазоне**,  
- оценивать выплату,   
- прогнозировать стоимость продукта.

## Реализованные функции
- val_params_cir - валидация параметров по модели CIR
- val_params_fx - валидация параметров по лог-нормальной модели
- eps_for_rho - коррелированность
- simulate_triple_model_by_dates - проводит непосредственные симмуляции
- pricing_range_accrual прайсит продукт **Range Accrual**

  ## Проверка результата
Для проверки результата можно прогнать весь код и отдельно поиграться с функцией:
```
pricing_range_accrual(
    start_date = '2021-12-10',
    end_date = '2021-12-31',
    params=params1
    , nominal=100000
    , derivative = 'FX'
    , upper_limit = 90
    , lower_limit = 70
)
```
где:
- start_date начало симмуляци
- end_date конец симмуляций
- params параметры на который мы находим важные для нас параметры
    - params1 - все симмуляции проводятся заново, без учета полученной инфы в ноуте
    - params2 - полученные параметры в ноуте используются
- derivative - по какому деривативу мы считаем продукт. базово для обменного курса, но по приколу можно и на валюты посмотреть
- upper_limit - верхняя граница
- lower_limit - нижняя граница
